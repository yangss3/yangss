import{_ as n,r as a,c as s,b as t,d as l,e as o,o as e}from"./app.9096b5b7.js";const c='{"title":"Blob 是什么？","description":"","frontmatter":{},"headers":[{"level":2,"title":"Blob 转 URL","slug":"blob-转-url"},{"level":2,"title":"Blob 转 Base64","slug":"blob-转-base64"},{"level":2,"title":"为 image 生成 Blob","slug":"为-image-生成-blob"},{"level":2,"title":"Blob 转 ArrayBuffer","slug":"blob-转-arraybuffer"},{"level":2,"title":"总结","slug":"总结"}],"relativePath":"articles/what-is-blob.md","lastUpdated":1641308164901}',u={},p=l("h1",{id:"blob-是什么？",tabindex:"-1"},[o("Blob 是什么？ "),l("a",{class:"header-anchor",href:"#blob-是什么？","aria-hidden":"true"},"#")],-1),r=l("p",null,[o("前面讲到了 "),l("code",null,"ArrayBuffer"),o(" 和 "),l("code",null,"TypedArray"),o(" 等概念，它们属于 ECMA 标准，是 JavaScript 的一部分。")],-1),k=l("p",null,[o("而在浏览器中，也有一个用于描述二进制数据的对象，即 "),l("code",null,"Blob"),o(" (Binary large object)。它是一个不可变的包含原始数据的类文件对象。"),l("code",null,"Blob"),o(" 的主要作用是方便在浏览器中进行文件操作，例如上传，下载，图片展示等等。")],-1),i=l("p",null,[l("code",null,"Blob"),o(" 主要包含两个部分，一个可选的字符串类型的 "),l("code",null,"type"),o("（通常是 MIME-type）和一个包含 "),l("code",null,"ArrayBuffer"),o(" / "),l("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/ArrayBufferView",target:"_blank",rel:"noopener noreferrer"},"ArrayBufferView"),o(" / "),l("code",null,"Blob"),o(" / "),l("code",null,"String"),o(" 的 "),l("code",null,"blobParts"),o("：")],-1),d=l("img",{src:"/yangss/assets/blob.c24a98df.svg",class:"mx-auto mt-20px mb-30px"},null,-1),b=l("p",null,[o("创建一个 "),l("code",null,"Blob"),o(" 的语法如下：")],-1),g=l("div",{class:"language-js"},[l("pre",null,[l("code",null,[l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"Blob"),l("span",{class:"token punctuation"},"("),o("blobParts"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token punctuation"},"["),o("options"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},")"),o("\n")])])],-1),f=l("ul",null,[l("li",null,[l("code",null,"blobParts"),o("：一个数组，里面可以是 "),l("code",null,"ArrayBuffer"),o(", ArrayBufferView, "),l("code",null,"Blob"),o(", "),l("code",null,"String"),o("，或它们的任意组合。")]),l("li",null,[l("code",null,"options"),o("：可选的对象 "),l("ul",null,[l("li",null,[l("code",null,"type"),o("： "),l("code",null,"Blob"),o(" 中存储的数据的 MIME-type，默认值为空字符串。")]),l("li",null,[l("code",null,"endings"),o("：是否转换行尾以使 "),l("code",null,"Blob"),o(" 对应于当前操作系统的换行("),l("code",null,"\\r\\n"),o(" 或 "),l("code",null,"\\n"),o(")。默认情况下是 "),l("code",null,"'transparent'"),o(" (不做任何操作)，但也可以是 "),l("code",null,"'native'"),o(" (转换)。")])])])],-1),A=l("p",null,[o("例如，从 string 创建 "),l("code",null,"Blob"),o("：")],-1),m=l("div",{class:"language-js"},[l("pre",null,[l("code",null,[l("span",{class:"token keyword"},"const"),o(" blob "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"Blob"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},"["),l("span",{class:"token string"},"'<html>...</html>'"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token punctuation"},"{"),o(" type"),l("span",{class:"token operator"},":"),o(),l("span",{class:"token string"},"'text/html'"),o(),l("span",{class:"token punctuation"},"}"),l("span",{class:"token punctuation"},")"),o("\n")])])],-1),B=l("p",null,[o("从 typed array 和 string 创建 "),l("code",null,"Blob"),o("：")],-1),y=l("div",{class:"language-js"},[l("pre",null,[l("code",null,[l("span",{class:"token keyword"},"const"),o(" hello "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"Uint8Array"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},"["),l("span",{class:"token number"},"72"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token number"},"101"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token number"},"108"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token number"},"108"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token number"},"111"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},")"),o(),l("span",{class:"token comment"},"// 'Hello' 的二进制形式"),o("\n"),l("span",{class:"token keyword"},"const"),o(" blob "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"Blob"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},"["),o("hello"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token string"},"' '"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token string"},"'world'"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token punctuation"},"{"),o(" type"),l("span",{class:"token operator"},":"),o(),l("span",{class:"token string"},"'text/plain'"),o(),l("span",{class:"token punctuation"},"}"),l("span",{class:"token punctuation"},")"),o("\n")])])],-1),h=l("p",null,[o("有一点需要注意，我们无法直接更改 "),l("code",null,"Blob"),o(" 内的数据，但可以从 "),l("code",null,"Blob"),o(" 中提取片段生成新的 "),l("code",null,"Blob"),o("：")],-1),w=l("div",{class:"language-js"},[l("pre",null,[l("code",null,[o("blob"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"slice"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},"["),o("byteStart"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token punctuation"},"["),o("byteEnd"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token punctuation"},"["),o("contentType"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},")"),o("\n")])])],-1),v=l("ul",null,[l("li",null,[l("code",null,"byteStart"),o("：起始字节位置，默认为 0")]),l("li",null,[l("code",null,"byteEnd"),o("：结束字节位置 (不包含)，默认到 blob 末尾")]),l("li",null,[l("code",null,"contentType"),o("：新的 blob 的类型, 默认与原 blob 相同")])],-1),R=l("p",null,[l("code",null,"blob.slice"),o(" 的用法与 "),l("code",null,"array.slice"),o(" 类似，同样支持负位置索引。")],-1),U=l("h2",{id:"blob-转-url",tabindex:"-1"},[o("Blob 转 URL "),l("a",{class:"header-anchor",href:"#blob-转-url","aria-hidden":"true"},"#")],-1),L=l("p",null,[o("前面说到 "),l("code",null,"Blob"),o(" 为文件而生，所以可以很容易的将 "),l("code",null,"Blob"),o(" 使用于 "),l("code",null,"<a>"),o(", "),l("code",null,"<img>"),o(" 或其它接受 url 的标签，用于展示其内容。")],-1),x=l("p",null,[o("这正是因为 "),l("code",null,"Blob"),o(" 包含了一个 "),l("code",null,"type"),o("，用于指定所存储的数据类型 (MIME-type)，有了这个类型，我们就可以正确的下载/上传 "),l("code",null,"Blob"),o(" 对象，也可以通过网络请求发送 "),l("code",null,"Blob"),o("，这时 "),l("code",null,"type"),o(" 会自动成为 "),l("code",null,"Content-Type"),o("。")],-1),j=l("p",null,[o("看下面这个例子，用户可以通过点击链接来下载一个包含 "),l("code",null,"'Hello, world'"),o(" 的文本文件：")],-1),P=l("div",{class:"language-html"},[l("pre",null,[l("code",null,[l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"<"),o("a")]),o(),l("span",{class:"token attr-name"},"download"),l("span",{class:"token attr-value"},[l("span",{class:"token punctuation attr-equals"},"="),l("span",{class:"token punctuation"},'"'),o("hello.txt"),l("span",{class:"token punctuation"},'"')]),o(),l("span",{class:"token attr-name"},"id"),l("span",{class:"token attr-value"},[l("span",{class:"token punctuation attr-equals"},"="),l("span",{class:"token punctuation"},'"'),o("link"),l("span",{class:"token punctuation"},'"')]),l("span",{class:"token punctuation"},">")]),o("Download"),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"</"),o("a")]),l("span",{class:"token punctuation"},">")]),o("\n\n"),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"<"),o("script")]),l("span",{class:"token punctuation"},">")]),l("span",{class:"token script"},[l("span",{class:"token language-javascript"},[o("\n"),l("span",{class:"token keyword"},"const"),o(" blob "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"Blob"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},"["),l("span",{class:"token string"},"'Hello, world'"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token punctuation"},"{"),o(" type"),l("span",{class:"token operator"},":"),o(),l("span",{class:"token string"},"'text/plain'"),o(),l("span",{class:"token punctuation"},"}"),l("span",{class:"token punctuation"},")"),o("\n"),l("span",{class:"token keyword"},"const"),o(" link "),l("span",{class:"token operator"},"="),o(" document"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"querySelector"),l("span",{class:"token punctuation"},"("),l("span",{class:"token string"},"'#link'"),l("span",{class:"token punctuation"},")"),o("\nlink"),l("span",{class:"token punctuation"},"."),o("href "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token constant"},"URL"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"createObjectURL"),l("span",{class:"token punctuation"},"("),o("blob"),l("span",{class:"token punctuation"},")"),o("\n")])]),l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"</"),o("script")]),l("span",{class:"token punctuation"},">")]),o("\n")])])],-1),O=l("p",null,[o("也可以通过 JavaScript 动态生成 link，然后通过 "),l("code",null,"link.click()"),o(" 模拟点击行为，这样无需任何 HTML，可以实现自动下载：")],-1),M=l("div",{class:"language-js"},[l("pre",null,[l("code",null,[l("span",{class:"token keyword"},"const"),o(" link "),l("span",{class:"token operator"},"="),o(" document"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"createElement"),l("span",{class:"token punctuation"},"("),l("span",{class:"token string"},"'a'"),l("span",{class:"token punctuation"},")"),o("\n\nlink"),l("span",{class:"token punctuation"},"."),o("download "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token string"},"'hello.txt'"),o("\n\n"),l("span",{class:"token keyword"},"const"),o(" blob "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"Blob"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},"["),l("span",{class:"token string"},"'Hello, world'"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token punctuation"},"{"),o(" type"),l("span",{class:"token operator"},":"),o(),l("span",{class:"token string"},"'text/plain'"),o(),l("span",{class:"token punctuation"},"}"),l("span",{class:"token punctuation"},")"),o("\n\nlink"),l("span",{class:"token punctuation"},"."),o("href "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token constant"},"URL"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"createObjectURL"),l("span",{class:"token punctuation"},"("),o("blob"),l("span",{class:"token punctuation"},")"),o("\n\nlink"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"click"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),o("\n\n"),l("span",{class:"token constant"},"URL"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"revokeObjectURL"),l("span",{class:"token punctuation"},"("),o("link"),l("span",{class:"token punctuation"},"."),o("href"),l("span",{class:"token punctuation"},")"),o("\n")])])],-1),D=l("p",null,[o("这里用到了 "),l("code",null,"URL.createObjectURL"),o(" 和 "),l("code",null,"URL.revokeObjectURL"),o(" 两个浏览器内置方法。")],-1),F=l("p",null,[l("code",null,"URL.createObjectURL"),o(" 接收一个 "),l("code",null,"Blob"),o(" 对象，并为它生成一个唯一的 URL ("),l("code",null,"blob:<origin>/<uuid>"),o(")。")],-1),H=l("p",null,[o("对每个 "),l("code",null,"URL.createObjectURL"),o(" 生成的 URL，浏览器会在内部存储一个 URL -> Blob 的映射。这样可以通过很简短的 URL 就能访问到 "),l("code",null,"Blob"),o("。而且该 URL 只在当前打开的文档中有效，即作用域为当前 session。")],-1),W=l("p",null,[o("但同时这也有一个副作用。由于存在 URL -> Blob 映射， "),l("code",null,"Blob"),o(" 本身会驻留在内存中。除非页面被卸载，否则浏览器无法自动释放它。这可能不是我们想要的。")],-1),I=l("p",null,[o("通过调用 "),l("code",null,"URL.revokeObjectURL(url)"),o(" 可以从内部映射中删除对 "),l("code",null,"Blob"),o(" 的引用，如果 "),l("code",null,"Blob"),o(" 没有其它引用，它将会被清除，并释放内存。")],-1),S=l("p",null,[o("在上面自动下载的例子中，因为只需要下载一次，所以后面立刻调用了 "),l("code",null,"URL.revokeObjectURL"),o(" 来释放内存。但在手动点击链接进行下载的例子中，我们希望可以多次下载，所以没有调用 "),l("code",null,"URL.revokeObjectURL"),o("，如果这样做，链接上的 "),l("code",null,"Blob"),o(" url 将会失效，因为它们之间的映射关系已经被移除了。")],-1),E=l("h2",{id:"blob-转-base64",tabindex:"-1"},[o("Blob 转 Base64 "),l("a",{class:"header-anchor",href:"#blob-转-base64","aria-hidden":"true"},"#")],-1),T=l("p",null,[o("除了可以通过 "),l("code",null,"URL.createObjectURL"),o(" 生成 "),l("code",null,"Blob"),o(" url 外，还可以将 "),l("code",null,"Blob"),o(" 转换成 base64 编码的字符串。")],-1),_=l("p",null,[o("这种编码方式将二进制数据表示为一串安全的“可读”字符。更重要的是，我们可以在 "),l("a",{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs",target:"_blank",rel:"noopener noreferrer"},"Data URL"),o(" 中使用这种编码。")],-1),C=l("p",null,[o("一个 Data URL 具有这样的形式："),l("code",null,"data:[<mediatype>][;base64],<data>"),o("。我们可以在任何地方使用这样的 url，就像常规 url 一样。例如")],-1),z=l("div",{class:"language-html"},[l("pre",null,[l("code",null,[l("span",{class:"token tag"},[l("span",{class:"token tag"},[l("span",{class:"token punctuation"},"<"),o("img")]),o(),l("span",{class:"token attr-name"},"src"),l("span",{class:"token attr-value"},[l("span",{class:"token punctuation attr-equals"},"="),l("span",{class:"token punctuation"},'"'),o("data:image/png;base64,R0lGODlhDAAMAKIFAF5LAP/zxAAAANyuAP/gaP///wAAAAAAACH5BAEAAAUALAAAAAAMAAwAAAMlWLPcGjDKFYi9lxKBOaGcF35DhWHamZUW0K4mAbiwWtuf0uxFAgA7"),l("span",{class:"token punctuation"},'"')]),l("span",{class:"token punctuation"},">")]),o("\n")])])],-1),K=l("p",null,[o("浏览器会解码这个字符串并展示这张图片"),l("img",{class:"inline-block ml-1",src:"data:image/png;base64,R0lGODlhDAAMAKIFAF5LAP/zxAAAANyuAP/gaP///wAAAAAAACH5BAEAAAUALAAAAAAMAAwAAAMlWLPcGjDKFYi9lxKBOaGcF35DhWHamZUW0K4mAbiwWtuf0uxFAgA7"}),o("。")],-1),q=l("p",null,[o("要将 "),l("code",null,"Blob"),o(" 转换成 base64，可以使用浏览器内置的 "),l("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/FileReader",target:"_blank",rel:"noopener noreferrer"},[l("code",null,"FileReader"),o(" API")]),o("，它能以多种不同的格式从 "),l("code",null,"Blob"),o(" 种读取数据。")],-1),G=l("p",null,[o("下面是使用 base64 的形式下载 "),l("code",null,"Blob"),o(" 的例子：")],-1),V=l("div",{class:"language-js"},[l("pre",null,[l("code",null,[l("span",{class:"token keyword"},"const"),o(" link "),l("span",{class:"token operator"},"="),o(" document"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"createElement"),l("span",{class:"token punctuation"},"("),l("span",{class:"token string"},"'a'"),l("span",{class:"token punctuation"},")"),o("\n\nlink"),l("span",{class:"token punctuation"},"."),o("download "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token string"},"'hello.txt'"),o("\n\n"),l("span",{class:"token keyword"},"const"),o(" blob "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"Blob"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},"["),l("span",{class:"token string"},"'Hello, world!'"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token punctuation"},"{"),o(" type"),l("span",{class:"token operator"},":"),o(),l("span",{class:"token string"},"'text/plain'"),o(),l("span",{class:"token punctuation"},"}"),l("span",{class:"token punctuation"},")"),o("\n\n"),l("span",{class:"token keyword"},"const"),o(" reader "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"FileReader"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),o("\n\nreader"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"readAsDataURL"),l("span",{class:"token punctuation"},"("),o("blob"),l("span",{class:"token punctuation"},")"),o(),l("span",{class:"token comment"},"// 以 base64 的格式从 blob 中读取数据"),o("\n\nreader"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function-variable function"},"onload"),o(),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"function"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),o(),l("span",{class:"token punctuation"},"{"),o("\n  link"),l("span",{class:"token punctuation"},"."),o("href "),l("span",{class:"token operator"},"="),o(" reader"),l("span",{class:"token punctuation"},"."),o("result "),l("span",{class:"token comment"},"// data url"),o("\n  link"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"click"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),o("\n"),l("span",{class:"token punctuation"},"}"),o("\n")])])],-1),J=l("p",null,[o("这两种创建 "),l("code",null,"Blob"),o(" URL 的方法都是可行的。但通常 "),l("code",null,"URL.createObjectURL(blob)"),o(" 更简单而且速度更快。两者对比如下：")],-1),N=l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"URL.createObjectURL(blob)"),l("th",null,"Blob to data url")])]),l("tbody",null,[l("tr",null,[l("td",null,"如果对内存泄露比较在意，需要手动 revoke 进行清理"),l("td",null,"无内存泄漏问题，无需手动清理")]),l("tr",null,[l("td",null,[o("直接访问 "),l("code",null,"Blob"),o("，没有 encoding / decoding 过程")]),l("td",null,[o("需要进行 base64 编码，当 "),l("code",null,"Blob"),o(" 很大时，会有性能问题，而且会占用更大的内存空间")])])])],-1),Y=l("h2",{id:"为-image-生成-blob",tabindex:"-1"},[o("为 image 生成 Blob "),l("a",{class:"header-anchor",href:"#为-image-生成-blob","aria-hidden":"true"},"#")],-1),Z=l("p",null,[o("也可以为图片生成 "),l("code",null,"Blob"),o("，然后进行上传和下载等等。")],-1),X=l("p",null,[o("对图片的操作可以借助 "),l("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial",target:"_blank",rel:"noopener noreferrer"},[l("code",null,"canvas")]),o(" 元素实现")],-1),Q=l("ul",null,[l("li",null,[o("使用 "),l("a",{href:"https://developer.mozilla.org/en-US/docs/Web/api/CanvasRenderingContext2D/drawImage",target:"_blank",rel:"noopener noreferrer"},[l("code",null,"canvas.drawImage")]),o(" 将图片画在 canvas 画布上。")]),l("li",null,[o("调用 "),l("a",{href:"https://developer.mozilla.org/en-US/docs/Web/api/HTMLCanvasElement/toBlob",target:"_blank",rel:"noopener noreferrer"},[l("code",null,".toBlob(callback, type, quality)")]),o(" 获取 "),l("code",null,"Blob"),o("，等待完成后会执行 "),l("code",null,"callback"),o(" 回调。")])],-1),$=l("div",{class:"language-js"},[l("pre",null,[l("code",null,[l("span",{class:"token comment"},"// 获取图片元素"),o("\n"),l("span",{class:"token keyword"},"const"),o(" img "),l("span",{class:"token operator"},"="),o(" document"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"querySelector"),l("span",{class:"token punctuation"},"("),l("span",{class:"token string"},"'img'"),l("span",{class:"token punctuation"},")"),o("\n\n"),l("span",{class:"token comment"},"// 创建一个相同尺寸的画布"),o("\n"),l("span",{class:"token keyword"},"const"),o(" canvas "),l("span",{class:"token operator"},"="),o(" document"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"createElement"),l("span",{class:"token punctuation"},"("),l("span",{class:"token string"},"'canvas'"),l("span",{class:"token punctuation"},")"),o("\ncanvas"),l("span",{class:"token punctuation"},"."),o("width "),l("span",{class:"token operator"},"="),o(" img"),l("span",{class:"token punctuation"},"."),o("clientWidth\ncanvas"),l("span",{class:"token punctuation"},"."),o("height "),l("span",{class:"token operator"},"="),o(" img"),l("span",{class:"token punctuation"},"."),o("clientHeight\n\n"),l("span",{class:"token keyword"},"const"),o(" context "),l("span",{class:"token operator"},"="),o(" canvas"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"getContext"),l("span",{class:"token punctuation"},"("),l("span",{class:"token string"},"'2d'"),l("span",{class:"token punctuation"},")"),o("\n\n"),l("span",{class:"token comment"},"// 复制图片到画布 (还可能通过这个方法对图片进行裁剪)"),o("\ncontext"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"drawImage"),l("span",{class:"token punctuation"},"("),o("img"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token number"},"0"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token number"},"0"),l("span",{class:"token punctuation"},")"),o("\n\n"),l("span",{class:"token comment"},"// toBlob 是异步操作, callback 会在完成后执行"),o("\ncanvas"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"toBlob"),l("span",{class:"token punctuation"},"("),l("span",{class:"token keyword"},"function"),l("span",{class:"token punctuation"},"("),l("span",{class:"token parameter"},"blob"),l("span",{class:"token punctuation"},")"),o(),l("span",{class:"token punctuation"},"{"),o("\n  "),l("span",{class:"token comment"},"// 拿到 blob，进行下载"),o("\n  "),l("span",{class:"token keyword"},"const"),o(" link "),l("span",{class:"token operator"},"="),o(" document"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"createElement"),l("span",{class:"token punctuation"},"("),l("span",{class:"token string"},"'a'"),l("span",{class:"token punctuation"},")"),o("\n  link"),l("span",{class:"token punctuation"},"."),o("download "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token string"},"'example.png'"),o("\n\n  link"),l("span",{class:"token punctuation"},"."),o("href "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token constant"},"URL"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"createObjectURL"),l("span",{class:"token punctuation"},"("),o("blob"),l("span",{class:"token punctuation"},")"),o("\n  link"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"click"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),o("\n\n  "),l("span",{class:"token comment"},"// 删除内部 blob 引用, 让浏览器释放内存"),o("\n  "),l("span",{class:"token constant"},"URL"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"revokeObjectURL"),l("span",{class:"token punctuation"},"("),o("link"),l("span",{class:"token punctuation"},"."),o("href"),l("span",{class:"token punctuation"},")"),o("\n"),l("span",{class:"token punctuation"},"}"),l("span",{class:"token punctuation"},","),o(),l("span",{class:"token string"},"'image/png'"),l("span",{class:"token punctuation"},")"),o("\n")])])],-1),nn=l("h2",{id:"blob-转-arraybuffer",tabindex:"-1"},[o("Blob 转 ArrayBuffer "),l("a",{class:"header-anchor",href:"#blob-转-arraybuffer","aria-hidden":"true"},"#")],-1),an=l("p",null,[o("我们可以使用 "),l("code",null,"Blob()"),o(" 构造函数从几乎任何东西创建一个 blob，包括 "),l("code",null,"ArrayBuffer"),o(" 和所有 "),l("code",null,"ArrayBufferView"),o("。")],-1),sn=l("p",null,[o("但如果我们要行进 low-level 的操作，可以使用 "),l("code",null,"FileReader"),o(" 获取 "),l("code",null,"Blob"),o(" 最底层的 "),l("code",null,"ArrayBuffer"),o("：")],-1),tn=l("div",{class:"language-js"},[l("pre",null,[l("code",null,[l("span",{class:"token comment"},"// 从 Blob 获取 ArrayBuffer"),o("\n"),l("span",{class:"token keyword"},"const"),o(" fileReader "),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"new"),o(),l("span",{class:"token class-name"},"FileReader"),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},")"),o("\n\nfileReader"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function"},"readAsArrayBuffer"),l("span",{class:"token punctuation"},"("),o("blob"),l("span",{class:"token punctuation"},")"),o("\n\nfileReader"),l("span",{class:"token punctuation"},"."),l("span",{class:"token function-variable function"},"onload"),o(),l("span",{class:"token operator"},"="),o(),l("span",{class:"token keyword"},"function"),l("span",{class:"token punctuation"},"("),l("span",{class:"token parameter"},"event"),l("span",{class:"token punctuation"},")"),o(),l("span",{class:"token punctuation"},"{"),o("\n  "),l("span",{class:"token keyword"},"const"),o(" arrayBuffer "),l("span",{class:"token operator"},"="),o(" fileReader"),l("span",{class:"token punctuation"},"."),o("result\n"),l("span",{class:"token punctuation"},"}"),o("\n")])])],-1),ln=l("h2",{id:"总结",tabindex:"-1"},[o("总结 "),l("a",{class:"header-anchor",href:"#总结","aria-hidden":"true"},"#")],-1),on=l("ul",null,[l("li",null,[l("code",null,"ArrayBuffer"),o(", "),l("code",null,"Uint8Array "),o(" 等等其它 "),l("code",null,"ArrayBufferView"),o(" 都属于二进制数据，而 "),l("code",null,"Blob"),o(" 代表的是有类型 (type) 的二进制数据。")]),l("li",null,[o("因为 "),l("code",null,"Blob"),o(" 具有类型，这使得它可以方便地进行上传/下载操作，这些操作在浏览器中非常常见。")]),l("li",null,[l("code",null,"XMLHttpRequest"),o(", "),l("code",null,"fetch"),o(" web请求原生地支持 Blob 类型。")]),l("li",null,[l("code",null,"Blob"),o(" 和 low-level 的二进制数据类型可以进行相互转换。")])],-1);var en=n(u,[["render",function(n,l,o,c,u,en){const cn=a("PubDate");return e(),s("div",null,[p,t(cn,{date:"2021/11/22"}),r,k,i,d,b,g,f,A,m,B,y,h,w,v,R,U,L,x,j,P,O,M,D,F,H,W,I,S,E,T,_,C,z,K,q,G,V,J,N,Y,Z,X,Q,$,nn,an,sn,tn,ln,on])}]]);export{c as __pageData,en as default};
