<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解 ArrayBuffer 和 TypedArray | YangSS</title>
    <meta name="description" content="Nicholas Yang's personal blog.">
    <link rel="stylesheet" href="/yangss/assets/style.e13d1cc2.css">
    <link rel="modulepreload" href="/yangss/assets/app.144f2fe4.js">
    <link rel="modulepreload" href="/yangss/assets/articles_understand-arraybuffer.md.654fe222.lean.js">
    
    <meta name="twitter:title" content="深入理解 ArrayBuffer 和 TypedArray | YangSS">
  <meta property="og:title" content="深入理解 ArrayBuffer 和 TypedArray | YangSS">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-22035cf8><div class="sidebar-button" data-v-22035cf8><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/yangss/" aria-label="YangSS, back to home" data-v-22035cf8 data-v-6f1fa1d8><!----> YangSS</a><div class="flex-grow" data-v-22035cf8></div><div class="nav" data-v-22035cf8><nav class="nav-links" data-v-22035cf8 data-v-32f7c87e><!--[--><div class="item" data-v-32f7c87e><div class="nav-link" data-v-32f7c87e data-v-e307cbc6><a class="item active" href="/yangss/articles/" data-v-e307cbc6>Articles <!----></a></div></div><div class="item" data-v-32f7c87e><div class="nav-link" data-v-32f7c87e data-v-e307cbc6><a class="item" href="/yangss/notes/" data-v-e307cbc6>Notes <!----></a></div></div><div class="item" data-v-32f7c87e><div class="nav-link" data-v-32f7c87e data-v-e307cbc6><a class="item" href="/yangss/projects" data-v-e307cbc6>Projects <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--[--><div class="flex space-x-5 ml-5"><button class="icon-button" title="Bookmarks" data-v-2a441c41><!--[--><svg class="relative top-2px" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="m17 18l-5-2.18L7 18V5h10m0-2H7a2 2 0 0 0-2 2v16l7-3l7 3V5a2 2 0 0 0-2-2Z"></path></svg><!--]--></button><button class="icon-button" title="GitHub" data-v-2a441c41><a href="https://github.com/yangss3" target="_blank" data-v-2a441c41><!--[--><svg class="relative top-2px" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M16.24 22a1 1 0 0 1-1-1v-2.6a2.15 2.15 0 0 0-.54-1.66a1 1 0 0 1 .61-1.67C17.75 14.78 20 14 20 9.77a4 4 0 0 0-.67-2.22a2.75 2.75 0 0 1-.41-2.06a3.71 3.71 0 0 0 0-1.41a7.65 7.65 0 0 0-2.09 1.09a1 1 0 0 1-.84.15a10.15 10.15 0 0 0-5.52 0a1 1 0 0 1-.84-.15a7.4 7.4 0 0 0-2.11-1.09a3.52 3.52 0 0 0 0 1.41a2.84 2.84 0 0 1-.43 2.08a4.07 4.07 0 0 0-.67 2.23c0 3.89 1.88 4.93 4.7 5.29a1 1 0 0 1 .82.66a1 1 0 0 1-.21 1a2.06 2.06 0 0 0-.55 1.56V21a1 1 0 0 1-2 0v-.57a6 6 0 0 1-5.27-2.09a3.9 3.9 0 0 0-1.16-.88a1 1 0 1 1 .5-1.94a4.93 4.93 0 0 1 2 1.36c1 1 2 1.88 3.9 1.52a3.89 3.89 0 0 1 .23-1.58c-2.06-.52-5-2-5-7a6 6 0 0 1 1-3.33a.85.85 0 0 0 .13-.62a5.69 5.69 0 0 1 .33-3.21a1 1 0 0 1 .63-.57c.34-.1 1.56-.3 3.87 1.2a12.16 12.16 0 0 1 5.69 0c2.31-1.5 3.53-1.31 3.86-1.2a1 1 0 0 1 .63.57a5.71 5.71 0 0 1 .33 3.22a.75.75 0 0 0 .11.57a6 6 0 0 1 1 3.34c0 5.07-2.92 6.54-5 7a4.28 4.28 0 0 1 .22 1.67V21a1 1 0 0 1-.94 1Z"></path></svg><!--]--></a></button><button class="icon-button" data-v-2a441c41><!--[--><svg class="relative top-2px" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" width="1.2em" height="1.2em" style="display:none;"><path fill="currentColor" d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938A7.999 7.999 0 0 0 4 12z"></path></svg><svg class="relative top-2px" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" width="1.2em" height="1.2em" style=""><path fill="currentColor" d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg><!--]--></button></div><!--]--><!--]--></header><aside class="sidebar" data-v-928cb7a2><nav class="nav-links nav" data-v-928cb7a2 data-v-32f7c87e><!--[--><div class="item" data-v-32f7c87e><div class="nav-link" data-v-32f7c87e data-v-e307cbc6><a class="item active" href="/yangss/articles/" data-v-e307cbc6>Articles <!----></a></div></div><div class="item" data-v-32f7c87e><div class="nav-link" data-v-32f7c87e data-v-e307cbc6><a class="item" href="/yangss/notes/" data-v-e307cbc6>Notes <!----></a></div></div><div class="item" data-v-32f7c87e><div class="nav-link" data-v-32f7c87e data-v-e307cbc6><a class="item" href="/yangss/projects" data-v-e307cbc6>Projects <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-928cb7a2><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/switch-true-pattern">妙用 switch(true)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/what-is-blob">Blob 是什么？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/yangss/articles/understand-arraybuffer">深入理解 ArrayBuffer 和 TypedArray</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#arraybuffer">ArrayBuffer</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#typedarray">TypedArray</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#dataview">DataView</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#总结">总结</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/understand-weakmap-and-weakset">深入理解 WeakMap 和 WeakSet</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/understand-cors">深入理解 CORS</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/async-setup">异步 setup</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/understand-unknown-in-typescript">深入理解 TypeScript 中的 unknown</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/excess-property-checking-in-typescript">TypeScript 中的超出属性检查 (Excess property checking)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/how-context-is-used-in-typescript">理解上下文 (Context) 在类型推断中的作用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/understand-ts-type-system">深入理解 TypeScript 的类型系统</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/explaining-proxy-and-reflect-in-detail">详解 Proxy 和 Reflect</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/what-is-currying">什么是柯里化 (Currying)？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/settimeout-setinterval">setTimeout 和 setInterval</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/yangss/articles/what-is-decorator-pattern">什么是装饰者模式？</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-338937e7><div class="container" data-v-338937e7><!--[--><!--]--><div style="position:relative;" class="content" data-v-338937e7><div><h1 id="深入理解-arraybuffer-和-typedarray" tabindex="-1">深入理解 ArrayBuffer 和 TypedArray <a class="header-anchor" href="#深入理解-arraybuffer-和-typedarray" aria-hidden="true">#</a></h1><p class="text-gray-400 dark:text-gray-600 flex items-center space-x-2 mb-24px"><svg class="relative top-2px !top-1px" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M9 10v2H7v-2h2m4 0v2h-2v-2h2m4 0v2h-2v-2h2m2-7a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h1V1h2v2h8V1h2v2h1m0 16V8H5v11h14M9 14v2H7v-2h2m4 0v2h-2v-2h2m4 0v2h-2v-2h2Z"></path></svg><span>2021/11/17</span></p><p>在 Web 开发中，我们经常有处理文件的需求，例如图片处理，文件上传/下载等等，这时我们可能需要和二进制数据(binary data)打交道，但这往往会让人头疼，因为 JavaScript 中有很多和二进制相关的内置对象，例如：<code>ArrayBuffer</code>, <code>Uint8Array</code>, <code>DataView</code> 等等。它们分别代表什么？有什么区别？该怎么使用它们？下面就来缕一缕。</p><h2 id="arraybuffer" tabindex="-1">ArrayBuffer <a class="header-anchor" href="#arraybuffer" aria-hidden="true">#</a></h2><p>JavaScript 中最基本的二进制对象就是 <code>ArrayBuffer</code>，它代表的是对一个<strong>固定长度的连续内存空间的引用</strong>，比如我们创建一个 buffer 如下：</p><div class="language-js"><pre><code><span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span> <span class="token comment">// 16</span>
</code></pre></div><p>上面的代码会分配一个16字节长度的连续内存空间，在其中填充0作为初始值，并将引用赋值给 <code>buffer</code> 变量。</p><p>这里首先要消除的一点迷惑是：虽然 <code>ArrayBuffer</code> 名字里含有 &#39;Array&#39; 的字样，但 <strong><code>ArrayBuffer</code> 并不是数组</strong>，它和数组没有任何关系：</p><ul><li>它有固定的长度，而且一旦生成(完成分配)，就无法再更改它的长度。</li><li>根据提供初始化参数，它占据准确的内存空间。</li><li>无法通过索引的方式 <code>buffer[index]</code> 访问单个字节，需要通过视图对象(view object)来访问。</li></ul><p>它代表的是一块内存区域，除了知道里面存储的是一段原始的字节序列，此外别无所知。</p><p>上面说到，要想对 <code>ArrayBuffer</code> 进行操作，需要用到一个视图对象(view object)。视图对象本身不存储任何值，它的作用是对 <code>ArrayBuffer</code> 加一层代理接口，透过它可以对 <code>ArrayBuffer</code> 中存储的二进制数据进行描述，例如：</p><ul><li><code>Uint8Array</code>: 将 <code>ArrayBuffer</code> 中的每个字节看作一个8位无符号整数(0-255)</li><li><code>Uint16Array</code>: 将 <code>ArrayBuffer</code> 中的每两个字节看作一个16位无符号整数(0-65535)</li><li><code>Uint32Array</code>: 将 <code>ArrayBuffer</code> 中的每4个字节看作一个32位无符号整数(0-4294967295)</li><li><code>Float64Array</code>: 将 <code>ArrayBuffer</code> 中的每8个字节看作一个浮点数(5.0 x 10^-324 - 1.8 x 10^308)</li></ul><p>所以一个 16字节大小的 <code>ArrayBuffer</code> 可以被解释为 <em>16个8位无符号整数(0-255)</em>, <em>8个16位无符号整数(0-65535)</em>, <em>4个32位无符号整数(0-4294967295)<em>或</em>两个浮点数</em>。</p><p>视图对象除了对 <code>ArrayBuffer</code> 进行描述外，还能通过它操作 <code>ArrayBuffer</code> 内的数据：</p><div class="language-js"><pre><code><span class="token comment">// 创建16字节长度的buffer</span>
<span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token comment">// 将 buffer 看作是32位整数的序列</span>
<span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Uint32Array<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">)</span> <span class="token comment">// 每个整数占4个字节</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment">// 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span> <span class="token comment">// 16</span>

<span class="token comment">// 写入值</span>
view<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123456</span>

<span class="token comment">// 迭代值</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> num <span class="token keyword">of</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>  <span class="token comment">// 123456, 0, 0, 0</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="typedarray" tabindex="-1">TypedArray <a class="header-anchor" href="#typedarray" aria-hidden="true">#</a></h2><p>首先请注意，并没有名为 <code>TypedArray</code> 的构造函数，它只是上面那些视图对象(<code>Uint8Array</code>, <code>Uint16Array</code> 等)的通用术语，表示的是 <code>ArrayBuffer</code> 上的一个视图。 所有的 <code>TypedArray</code> 共享同一套方法和属性，而且它们的行为类似于常规数组，具有索引，可迭代，可读写。</p><p>一个 typed array 的构造函数可以接受5种不同形式的参数：</p><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">TypedArray</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token punctuation">[</span>byteOffset<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// (1)</span>
<span class="token keyword">new</span> <span class="token class-name">TypedArray</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span> <span class="token comment">// (2)</span>
<span class="token keyword">new</span> <span class="token class-name">TypedArray</span><span class="token punctuation">(</span>typedArray<span class="token punctuation">)</span> <span class="token comment">// (3)</span>
<span class="token keyword">new</span> <span class="token class-name">TypedArray</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span> <span class="token comment">// (4)</span>
<span class="token keyword">new</span> <span class="token class-name">TypedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (5)</span>
</code></pre></div><ol><li>如果提供 <code>ArrayBuffer</code> 作为第一个参数，则在它上面生成一个 view，前面的例子中已经使用过这种语法。除此之外还可以接受起始位置和长度作为可选参数，这样将为指定的 buffer 区间生成 view。</li><li>如果提供一个数组或类数组对象，则会生成一个相同长度的 typed array，同时复制数组的内容：<div class="language-js"><pre><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment">// 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div></li><li>如果提供另一个 <code>TypedArray</code> 作为参数，也会生成一个相同长度的 typed array，同时复制数组的内容，而且如果需要，值的类型可以转换为新的类型：<div class="language-js"><pre><code><span class="token keyword">const</span> arr16 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> arr8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>arr16<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr8<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr8<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 232, 由于 1000 超出一个字节(8 bits)长度，会发生截断</span>
</code></pre></div></li><li>如果提供一个长度作为参数，则生成指定长度的 typed array：<div class="language-js"><pre><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 生成包含4个元素的 typed array</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Uint16Array<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span> <span class="token comment">// 8</span>
</code></pre></div></li><li>不传任何参数，则生成0长度的 typed array。</li></ol><p>注意，虽然上面除了 (1) ，其它似乎都没有依托 <code>ArrayBuffer</code>， 而是直接生成了 typed array。但实际上 view 是不能独立于 <code>ArrayBuffer</code> 存在的，每个 typed array 必须要有关联的 <code>ArrayBuffer</code>，所以除了 (1) 的情况，其它调用形式都会自动创建一个 <code>ArrayBuffer</code>。</p><p>要访问底层的 <code>ArrayBuffer</code>，可以使用 <code>TypedArray</code> 以下属性：</p><ul><li><code>buffer</code>：<code>ArrayBuffer</code> 的引用</li><li><code>byteLength</code>：<code>ArrayBuffer</code> 的字节长度</li></ul><p>例如可以从一种视图转换为另一种视图：</p><div class="language-js"><pre><code><span class="token keyword">const</span> arr8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 同一份 ArrayBuffer 的另一种视图</span>
<span class="token keyword">const</span> arr16 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>arr8<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
</code></pre></div><p>以下是所有 JavaScript 内置的 typed array：</p><ul><li><code>Uint8Array</code>, <code>Uint16Array</code>, <code>Uint32Array</code>：8位，16位和32位无符号整数</li><li><code>Uint8ClampedArray</code>：8位无符号整数，但是当超出范围时，截断方式与 <code>Uint8Array</code> 不同 (超过255时取255，小于0时取0)</li><li><code>Int8Array</code>, <code>Int16Array</code>, <code>Int32Array</code>：8位，16位和32位有符号整数</li><li><code>Float32Array</code>, <code>Float64Array</code>：32位和64位有符号浮点数</li></ul><p><code>TypedArray</code> 具有常规的数组方法，例如我们可以迭代它 (iterate)，也可以使用 <code>map</code>, <code>slice</code>, <code>find</code>, <code>reduce</code> 等方法。</p><p>但也有一些例外，例如下面的方法不能使用：</p><ul><li>没有 <code>splice</code> 方法：不能删除一个值，因为 typed array 操作的是底层的 <code>ArrayBuffer</code>，即一片连续的长度固定的内存空间，我们无法删除它或改变它的长度，唯一能做的就是给它填充0。</li><li>没有 <code>concat</code> 方法。</li></ul><p>同时也包含两个额外的方法：</p><ul><li><code>arr.set(fromArr, [offset])</code>：从 <code>offset</code>位置 (默认为0) 开始，复制 <code>fromArr</code> 中的元素到 <code>arr</code>。</li><li><code>arr.subarray([begin, end])</code>：为 <code>[begin, end)</code> 区间的数据创建一个相同类型的新的 view，作用与 <code>slice</code> 类似，但是它不会复制出新的数据 (buffer)，只是在原数据上生成新的 view。</li></ul><h2 id="dataview" tabindex="-1">DataView <a class="header-anchor" href="#dataview" aria-hidden="true">#</a></h2><p><code>DataView</code> 是 <code>ArrayBuffer</code> 上一个特殊的，且非常灵活的 &quot;非类型 (untyped)&quot;视图。它允许以任何格式访问任何偏移量的数据。</p><p>这是什么意思？</p><p>前面提到的 typed array，它们的构造函数决定了它们以什么样的格式描述 buffer，一旦创建了视图，整个 typed array 内的每个元素类型都是统一的，例如一个 <code>Uint8Array</code> 类型的 <code>arr</code>，我们通过 <code>arr[i]</code> 就只能访问到它的第 i 个元素。但是 <code>DataView</code> 不同，<code>DataView</code> 使用 <code>.getUint8(i)</code> 或 <code>.getUint16(i)</code> 这样的方式来访问数据，即在方法调用时，而不是在构造函数初始化视图时，确定访问的数据类型。这样大大增加了灵活性。</p><p>要生成一个 <code>DataView</code>, 使用如下语法：</p><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token punctuation">[</span>byteOffset<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>byteLength<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><code>buffer</code>：底层的 <code>ArrayBuffer</code>，与 typed array 不同，<code>DataView</code> 不会自动为自己创建一个 buffer，所以必须传入 buffer 参数。</li><li><code>byteOffset</code>：视图的起始字节位置 (默认为 0)</li><li><code>byteLength</code>: 视图的字节长度 (默认直到包含 buffer 的末尾)</li></ul><p>例如，我们在同一个 buffer 上以不同的格式提取数字：</p><div class="language-js"><pre><code><span class="token comment">// 四字节的二进制数据， 每个字节包含最大数值 255</span>
<span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>buffer
<span class="token keyword">const</span> dataView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>

<span class="token comment">// 获取偏移量 0 处占据 8 bits (一个字节) 的数字</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dataView<span class="token punctuation">.</span><span class="token function">getUint8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 255</span>

<span class="token comment">// 获取偏移量 0 处占据 16 bits (两个字节) 的数字</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dataView<span class="token punctuation">.</span><span class="token function">getUint16</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 65535</span>

<span class="token comment">// 获取偏移量 0 处占据 32 bits (四个字节) 的数字</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dataView<span class="token punctuation">.</span><span class="token function">getUint32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 4294967295</span>

<span class="token comment">// 将偏移量 0 处占据 32 bits (四个字节)长度的数据设为 0，即所有字节都设置为 0</span>
dataView<span class="token punctuation">.</span><span class="token function">setUint32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>当我们要在同一个 buffer 中存储混合格式的数据时，<code>DataView</code> 非常有用。例如，当我们要存储一连串的 (16位整数，32位浮点数) 这样的数值对时，<code>DataView</code> 可以让我们轻松地访问它们。</p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h2><ul><li><code>ArrayBuffer</code> 是存储二进制数据的核心对象，它本质是一个对固定长度的连续内存区域的引用。</li><li>要操作 <code>ArrayBuffer</code> 内的数据，需要通过视图对象来完成。 <ul><li>它可以是一个 <code>TypedArray</code>，例如 <code>Uint8Array</code>, <code>Uint16Array</code>, <code>Float32Array</code> 等等。</li><li>也可以是一个 <code>DataView</code></li></ul></li><li>在大多数情况下，我们直接创建和操作 typed array，而把 <code>ArrayBuffer</code> 作为底层数据源，如果需要，可以通过 <code>.buffer</code> 来访问它。</li></ul></div></div><footer class="page-footer" data-v-338937e7 data-v-4b207065><div class="edit" data-v-4b207065><div class="edit-link" data-v-4b207065 data-v-76b066b8><!----></div></div><div class="updated" data-v-4b207065><!----></div></footer><div class="next-and-prev-link" data-v-338937e7 data-v-19df4348><div class="container" data-v-19df4348><div class="prev" data-v-19df4348><a class="link" href="/yangss/articles/what-is-blob" data-v-19df4348><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-19df4348><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-19df4348>Blob 是什么？</span></a></div><div class="next" data-v-19df4348><a class="link" href="/yangss/articles/understand-weakmap-and-weakset" data-v-19df4348><span class="text" data-v-19df4348>深入理解 WeakMap 和 WeakSet</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-19df4348><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"49628808\",\"articles_async-setup.md\":\"d2735400\",\"articles_excess-property-checking-in-typescript.md\":\"8023d3b5\",\"articles_explaining-proxy-and-reflect-in-detail.md\":\"e4ae1151\",\"articles_how-context-is-used-in-typescript.md\":\"e60c5b03\",\"articles_index.md\":\"f8d7b882\",\"articles_settimeout-setinterval.md\":\"6488c02f\",\"articles_switch-true-pattern.md\":\"5fcf0e96\",\"articles_understand-arraybuffer.md\":\"654fe222\",\"articles_understand-cors.md\":\"00dd52e7\",\"articles_understand-ts-type-system.md\":\"d124dcf5\",\"articles_understand-unknown-in-typescript.md\":\"f482624c\",\"articles_understand-weakmap-and-weakset.md\":\"d8b9a993\",\"articles_what-is-blob.md\":\"90393f3f\",\"articles_what-is-currying.md\":\"4e696576\",\"articles_what-is-decorator-pattern.md\":\"97ae9e4c\",\"bookmarks.md\":\"703e0892\",\"index.md\":\"69063be3\",\"notes_git.md\":\"39eb1c74\",\"notes_index.md\":\"a1d40034\",\"notes_linux.md\":\"221bd0a0\",\"notes_nginx.md\":\"a55ee446\",\"notes_node-version-manager.md\":\"87746369\",\"notes_package-json.md\":\"434c8230\",\"notes_pkg-manager.md\":\"e5705844\",\"notes_regexp.md\":\"7c73b16a\",\"notes_type-challenges.md\":\"15229a37\",\"notes_typescript.md\":\"f9c4ddd6\",\"projects.md\":\"a2a4c341\"}")</script>
    <script type="module" async src="/yangss/assets/app.144f2fe4.js"></script>
    
  </body>
</html>